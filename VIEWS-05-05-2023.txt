--------------------*------------------------
--TICKET

--TIPO_TICEKT
CREATE OR REPLACE VIEW TIPO_TICKET_VIEW AS
SELECT TT.PK_TIPO_TICKET,TT.NOMBRE_TICKET FROM TIPO_TICKET TT
WITH READ ONLY;

--LISTA_TICKET
CREATE OR REPLACE VIEW LISTA_TICKET_VIEW AS
SELECT T.CEDULA_CIUDADANO,TK.NOMBRE_TICKET,
       TK.LETRA||'-'||T.NRO_TICKET AS NRO_TICKET,E.ESTATUS
       FROM TICKET T
       INNER JOIN TIPO_TICKET TK ON TK.PK_TIPO_TICKET =T.FK_TIPO_TICKET
       INNER JOIN ESTATUS E ON E.PK_ESTATUS = T.FK_ESTATUS
       WHERE E.PK_ESTATUS = 19
WITH READ ONLY;





-------------------*-------------------------
--ALMACEN

----ALMACEN_DISPONIBLES_VIEW

CREATE OR REPLACE VIEW ALMACEN_DISPONIBLES_VIEW AS
SELECT A.PK_ALMACEN,A.TIPO_ALMACEN,E.ESTATUS,A.OBSERVACION
FROM ALMACEN A
INNER JOIN ESTATUS E ON E.PK_ESTATUS = A.FK_ESTATUS
WHERE A.FK_ESTATUS NOT IN (5,14)
WITH READ ONLY;


--ALMACEN LLENO
CREATE OR REPLACE VIEW ALMACEN_LLENO_DANADO_VIEW AS
SELECT A.PK_ALMACEN,A.TIPO_ALMACEN,E.ESTATUS,A.OBSERVACION
FROM ALMACEN A
INNER JOIN ESTATUS E ON E.PK_ESTATUS = A.FK_ESTATUS
WHERE A.FK_ESTATUS NOT IN (2)
WITH READ ONLY;

--ALMACEN_VIEW
CREATE OR REPLACE VIEW ALMACEN_VIEW AS
SELECT A.PK_ALMACEN,A.TIPO_ALMACEN,A.PISO,A.PASILLO,E.ESTATUS,A.OBSERVACION
FROM ALMACEN A
INNER JOIN ESTATUS E ON E.PK_ESTATUS = A.FK_ESTATUS
WITH READ ONLY;


-----------------*--------------------------------
*----------------------*----------------------

--CIUDADANO

--CIUDADANO_VIEW
CREATE OR REPLACE VIEW CIUDADANOS_VIEW AS
SELECT C.PK_CIUDADANO,C.CEDULA,C.NOMBRE,C.APELLIDO,C.SEXO,TO_CHAR(C.FECHA_NACIMIENTO,'YYYY-MM-DD') AS FECHA_NACIMIENTO
       FROM CIUDADANO C
WITH READ ONLY;

----------------*-----------------------------
--INV_MEDICAMENTO

--ESTATUS
CREATE OR REPLACE VIEW ESTATUS_INV_MEDICAMENTO AS
SELECT E.PK_ESTATUS,E.ESTATUS FROM ESTATUS E
       WHERE E.PK_ESTATUS IN (2,15,16)
WITH READ ONLY;

--INV_MEDICAMENTO_VIEW
CREATE OR REPLACE VIEW INVENTARIO_MEDICAMENTOS_VIEW AS
SELECT M.NOMBRE_MEDICAMENTO,TM.TIPO_MEDICAMENTO,PM.PRESENT_MEDICAMENTO,DM.UNIDAD_MEDIDA,
       A.TIPO_ALMACEN,A.PISO,A.PASILLO,IM.CANTIDAD,IM.LOTE,
       TO_CHAR(IM.FECHA_VENCIMIENTO,'YYYY-MM-DD') AS FECHA_VENCIMIENTO,IM.OBSERVACION,
       M.COMPONENTE_PRINC,E.ESTATUS

FROM DETALLES_MEDICAMENTOS DM
INNER JOIN MEDICAMENTOS M ON DM.FK_MEDICAMENTO = M.PK_MEDICAMENTO
INNER JOIN TIPO_MEDICAMENTOS TM ON TM.PK_TIPO_MEDICAMENTO = M.FK_TIPO_MEDICAMENTO
INNER JOIN PRESENTACION_MEDICAMENTO PM ON PM.PK_PRES_MEDICAMENTO = DM.FK_PRES_MEDICAMENTO
INNER JOIN INVENTARIO_MEDICAMENTOS IM ON IM.FK_DETALLE_MEDIC = DM.PK_DETALLE_MEDIC
INNER JOIN ALMACEN A ON A.PK_ALMACEN = IM.FK_ALMACEN
INNER JOIN ESTATUS E ON E.PK_ESTATUS = IM.FK_ESTATUS
ORDER BY IM.CANTIDAD DESC
WITH READ ONLY;


----------------------*-----------------------------
---------------------*---------------------------
--MEDICAMENTOS

--MEDICAMENTO_VIEW
CREATE OR REPLACE VIEW MEDICAMENTOS_VIEW AS
SELECT M.PK_MEDICAMENTO,M.NOMBRE_MEDICAMENTO,TM.TIPO_MEDICAMENTO,M.COMPONENTE_PRINC
FROM MEDICAMENTOS M
INNER JOIN TIPO_MEDICAMENTOS TM ON TM.PK_TIPO_MEDICAMENTO = M.FK_TIPO_MEDICAMENTO
ORDER BY TM.TIPO_MEDICAMENTO ASC
WITH READ ONLY;

--UNIDAD_MEDIDA
CREATE OR REPLACE VIEW MEDICAMENTO_UNIDAD_MEDIDA_VIEW AS
SELECT M.NOMBRE_MEDICAMENTO ,DT.UNIDAD_MEDIDA,PM.PRESENT_MEDICAMENTO,DT.FK_MEDICAMENTO
       FROM MEDICAMENTOS M
INNER JOIN DETALLES_MEDICAMENTOS DT ON DT.FK_MEDICAMENTO = M.PK_MEDICAMENTO
INNER JOIN PRESENTACION_MEDICAMENTO PM ON PM.PK_PRES_MEDICAMENTO = DT.FK_PRES_MEDICAMENTO
WITH READ ONLY;

--PRESENTACION_MEDICAMENTO
CREATE OR REPLACE VIEW PRESENTACION_MEDICAMENTO_VIEW AS
SELECT PM.PK_PRES_MEDICAMENTO,PM.PRESENT_MEDICAMENTO
 FROM PRESENTACION_MEDICAMENTO PM
WITH READ ONLY;


--TIPO_MEDICAMENTO
CREATE OR REPLACE VIEW TIPO_MEDICAMENTOS_VIEW AS
SELECT TM.PK_TIPO_MEDICAMENTO,TM.TIPO_MEDICAMENTO
FROM TIPO_MEDICAMENTOS TM
--ORDER BY TM.TIPO_MEDICAMENTO ASC
WITH READ ONLY
;


----------------------------*-------------------------------
--------------------------------*---------------------------

--MEDICOS

--MEDICO_VIEW
CREATE OR REPLACE VIEW MEDICOS_VIEW AS
SELECT M.PK_MEDICOS,C.PK_CIUDADANO,C.NOMBRE,EP.ESPECIALIDAD,CF.COD_CENTRO_FARM,E.ESTATUS,M.MPPS,M.FECHA_INACTIVIDAD,M.OBSERVACION
FROM MEDICOS M
INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = M.FK_CIUDADANO
INNER JOIN ESPECIALIDAD EP ON EP.PK_ESPECIALIDAD = M.FK_ESPECIALIDAD
INNER JOIN CENTRO_FARMACEUTICO CF ON CF.PK_CENTRO_FARM = M.FK_CENTRO_FARM
INNER JOIN ESTATUS E ON E.PK_ESTATUS = M.FK_ESTATUS
WITH READ ONLY;

-----------------------*--------------------------------------------
-*------------------*--------------------------------------------

--PACIENTES

--PACIENTE_VIEW
CREATE OR REPLACE VIEW PACIENTES_VIEW AS
SELECT C.NOMBRE||' '||C.APELLIDO AS PACIENTE,C.SEXO,
       (SELECT C.NOMBRE FROM PARIENTE PT
         INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = PT.FK_CIUDADANO
         WHERE PT.PK_PARIENTE = P.FK_PARIENTE
       )AS PARIENTE
FROM PACIENTE P
INNER JOIN CIUDADANO C ON  C.PK_CIUDADANO = P.FK_CIUDADANO
--INNER JOIN PARIENTE PR ON PR.PK_PARIENTE = P.FK_PARIENTE

WITH READ ONLY
;

--PACIENTE_PATOLOGIA
CREATE OR REPLACE VIEW PACIENTES_PATOLOGIAS_VIEW AS
SELECT C.CEDULA,C.NOMBRE||' '|| C.APELLIDO AS PACIENTE,PT.NOMBRE_PATOLOGIA,
             (SELECT C.NOMBRE FROM MEDICOS M
              INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = M.FK_CIUDADANO
              WHERE M.PK_MEDICOS = PP.FK_MEDICO
              ) AS FARMACEUTICO ,
              (SELECT C.NOMBRE FROM PARIENTE PR
                       INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = PR.FK_CIUDADANO
                       WHERE PR.PK_PARIENTE = P.FK_PARIENTE
              ) AS PARIENTE,
              P.PESO,P.ALTURA,P.SUPERFICIE_CORPORAL,P.CORREO,P.TELEFONNO,P.TLF_ALTERNO,E.ESTATUS
       FROM PATOLOGIA_PACIENTE PP
       INNER JOIN PACIENTE P ON P.PK_PACIENTE = PP.FK_PACIENTE
       INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = P.FK_CIUDADANO
       --INNER JOIN PARIENTE PR ON PR.FK_CIUDADANO = C.PK_CIUDADANO
       --INNER JOIN MEDICOS M ON  M.FK_CIUDADANO = C.PK_CIUDADANO
       INNER JOIN PATOLOGIA PT ON PT.PK_PATOLOGIA = PP.FK_PATOLOGIA
       INNER JOIN ESTATUS E ON E.PK_ESTATUS = PP.FK_ESTATUS
       --WHERE C.CEDULA = 'V027588805'

WITH READ ONLY
;

--PACIENTE_RETIRIADO
CREATE OR REPLACE VIEW PACIENTE_RETIRADO_VIEW AS
SELECT C.NOMBRE||' '||C.APELLIDO AS CIUDADANO,C.SEXO,PR.OBSERVACION
         FROM PACIENTE_RETIRADO PR
INNER JOIN CIUDADANO C ON C.PK_CIUDADANO = PR.FK_CIUDADANO
WITH READ ONLY;


---------------------*-----------------------------------
-------------------*------------------------------------

--PATOLOGIA 

--PTOLOGIA_VIEW
CREATE OR REPLACE VIEW PATOLOGIAS_VIEW AS
SELECT P.PK_PATOLOGIA,P.NOMBRE_PATOLOGIA FROM PATOLOGIA P
WITH READ ONLY;












